# Agentic Todo - Full-Stack Web Application Constitution

<!--
Sync Impact Report:
- Version change: 1.0.0 â†’ 2.0.0
- Bump rationale: MAJOR - Backward-incompatible transformation from CLI to full-stack web application
- Modified principles:
  - Project Identity: CLI Todo â†’ Full-Stack Multi-User Web Application
  - Phase Model: Redefined from CLI phases to Web App phases (Core Web App, Usability, Intelligence)
  - Architecture: Added frontend (Next.js), backend (FastAPI), database (Neon PostgreSQL)
  - Authentication & Security: NEW - JWT-based auth with Better Auth
  - API Contract: NEW - RESTful API specification
  - Data Model: Enhanced to include user_id and timestamps
  - Monorepo Requirement: NEW - monorepo structure with frontend/backend separation
  - Technology Stack: Complete overhaul for web development
- Added sections:
  - Authentication & Security (Critical)
  - API Contract (Stable)
  - Monorepo Requirement
  - Agent Roles (expanded with frontend/backend implementers)
  - Agent Skills (expanded with full-stack skills)
- Removed sections: None (CLI remains as predecessor)
- Templates requiring updates:
  âš  plan-template.md - needs web app structure option validation
  âš  spec-template.md - verify alignment with multi-user requirements
  âš  tasks-template.md - verify web app task categorization
  âœ… constitution.md - updated
- Follow-up TODOs:
  - Validate template compatibility with monorepo structure
  - Update README.md to reflect full-stack architecture
-->

## Project Identity

**Project Name**: Agentic Todo â€“ Full-Stack Web Application

**Objective**: Transform the existing Todo console application into a modern, multi-user, full-stack web application using spec-driven, agentic development powered by Claude Code + Spec-Kit Plus.

The system must support persistent storage, authentication, REST APIs, and a responsive frontend, while strictly following the Agentic Dev Stack workflow.

**Purpose**: Demonstrate spec-driven development principles through a phased approach, building from core CRUD operations with authentication to intelligent task management with deterministic automation in a full-stack web environment.

---

## Core Principles

### I. Specification First (NON-NEGOTIABLE)

No code without an approved specification.

**Rules**:
- MUST complete specification before any planning or implementation
- MUST obtain user approval of spec before proceeding to plan
- MUST NOT skip or merge specification steps
- MUST NOT implement features not defined in the active phase's specification
- All code MUST trace back to a specification

**Rationale**: Specifications ensure clear requirements, prevent scope creep, and provide a single source of truth for what should be built. Without approved specs, development becomes reactive and inconsistent with project goals.

---

### II. Phase-Bound Enforcement (NON-NEGOTIABLE)

Only features explicitly allowed by the active phase may be implemented.

**Phase Boundaries**:
- **Phase 1 (Core Web App)**: Basic CRUD + Auth - Add Task, View Task List, Update Task, Delete Task, Mark Complete/Incomplete, User Authentication, JWT Security
- **Phase 2 (Usability)**: Search, filter, sort capabilities
- **Phase 3 (Intelligence)**: Advanced automation features

**Rules**:
- MUST NOT implement Phase 2 features during Phase 1
- MUST NOT implement Phase 3 features during Phase 1 or II
- MUST verify phase compliance before code review
- CLI is considered a predecessor, NOT an active phase

**Rationale**: Phase boundaries enforce incremental complexity, ensure working MVPs at each stage, and prevent premature optimization. Each phase must be stable before advancing.

---

### III. Agentic Workflow Only (NON-NEGOTIABLE)

All code MUST be written by Claude Code following the defined workflow. Human reviews, agents execute.

**Mandatory Workflow**:
1. Write spec
2. Plan implementation
3. Generate tasks
4. Implement
5. Review

**Rules**:
- MUST NOT skip workflow steps
- MUST follow: spec_writer â†’ planner_agent â†’ task_designer â†’ implementers â†’ quality_reviewer
- MUST NOT write code manually (human edits prohibited except for emergency fixes)
- All frontend and backend code MUST be generated by Claude Code
- MUST use reusable subagents (spec_writer, planner_agent, task_designer, frontend_implementer, backend_implementer, quality_reviewer)

**Rationale**: Structured workflow ensures consistency, traceability, and quality. Reusable agents build institutional knowledge and improve with each iteration.

---

### IV. Modular Full-Stack Architecture

System MUST maintain clear separation of concerns across frontend, backend, and database layers.

**Architecture Layers**:

**Frontend (Next.js 16+)**:
- App Router architecture
- TypeScript
- Responsive UI
- Communicates via REST API only

**Backend (Python FastAPI)**:
- RESTful API design
- Stateless authentication via JWT
- SQLModel ORM
- User data isolation

**Database (Neon Serverless PostgreSQL)**:
- Persistent storage
- User-scoped queries
- Schema managed via migrations

**Rules**:
- Frontend MUST NOT access database directly
- Backend MUST enforce JWT verification on all endpoints
- MUST maintain clear API contracts between layers
- MUST keep business logic in backend services
- MUST ensure each module has a single, well-defined responsibility

**Rationale**: Layered architecture enables independent testing, easier maintenance, and phase-safe extensibility. Clear boundaries prevent coupling and enable parallel development.

---

### V. Authentication & Security (CRITICAL)

All API endpoints MUST require valid JWT authentication and enforce user data isolation.

**Authentication System**:
- Frontend: Better Auth
- JWT tokens issued on login
- Token validation on every API request

**Security Rules**:
- ALL API endpoints require valid JWT (Authorization: Bearer <token>)
- Backend MUST verify token signature
- User identity extracted from token
- ALL database queries filtered by authenticated user
- Backend MUST verify user_id in URL matches JWT identity
- MUST NOT bypass authentication
- MUST NOT allow cross-user data access

**Shared Secret**:
- JWT signing secret: BETTER_AUTH_SECRET (environment variable)
- MUST be shared between frontend and backend
- MUST NOT be committed to version control

**Rationale**: Security is non-negotiable in multi-user systems. JWT-based stateless authentication ensures scalability while maintaining strong security boundaries.

---

### VI. API Contract Stability

API contracts MUST be stable, versioned, and strictly followed by frontend and backend.

**Base Path**: `/api/{user_id}/tasks`

**Endpoints**:
- `GET /api/{user_id}/tasks` - List user tasks
- `POST /api/{user_id}/tasks` - Create task
- `GET /api/{user_id}/tasks/{id}` - Get task
- `PUT /api/{user_id}/tasks/{id}` - Update task
- `DELETE /api/{user_id}/tasks/{id}` - Delete task
- `PATCH /api/{user_id}/tasks/{id}/complete` - Toggle completion

**Contract Rules**:
- Backend MUST verify user_id matches JWT identity
- MUST return appropriate HTTP status codes
- MUST include error messages in response body
- MUST validate request payloads
- Frontend MUST attach JWT to all requests
- MUST NOT break existing contracts without versioning

**Rationale**: Stable contracts enable independent frontend/backend development and prevent integration failures.

---

### VII. Data Model Integrity (Phase-Safe)

Data model MUST enforce user isolation and maintain referential integrity.

**Task Entity** (Phase 1):
```python
Task:
  - id: int (auto-increment)
  - user_id: string (required, indexed)
  - title: string (required)
  - description: string | null
  - completed: boolean (default: false)
  - created_at: datetime (auto)
  - updated_at: datetime (auto)
```

**Field Activation Rules**:
- Phase 1: Only fields listed above may be used
- Phase 2+: Additional fields only as introduced by phase spec
- MUST NOT activate fields before their defining phase
- NO additional fields allowed unless introduced by later spec

**Rationale**: Phase-safe data models prevent premature complexity and ensure clean migrations between phases.

---

### VIII. Monorepo Structure

Project MUST use monorepo organization with clear separation between frontend, backend, and shared configuration.

**Required Structure**:
```
hackathon-todo/
â”œâ”€â”€ .specify/
â”‚   â”œâ”€â”€ memory/constitution.md
â”‚   â”œâ”€â”€ templates/
â”‚   â””â”€â”€ scripts/
â”œâ”€â”€ specs/
â”‚   â”œâ”€â”€ overview.md
â”‚   â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ database/
â”‚   â””â”€â”€ ui/
â”œâ”€â”€ history/
â”‚   â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ adr/
â”œâ”€â”€ CLAUDE.md (root)
â”œâ”€â”€ README.md
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ CLAUDE.md
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ (Next.js app)
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ CLAUDE.md
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ (FastAPI app)
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ .env.example
```

**Rules**:
- MUST maintain separate CLAUDE.md for frontend and backend
- MUST use layer-specific configuration files
- Specs MUST be referenced using `@specs/...` notation
- Claude Code MUST read root CLAUDE.md + relevant specs + layer-specific CLAUDE.md

**Rationale**: Monorepo enables coordinated changes while maintaining separation of concerns and independent deployment capabilities.

---

### IX. Reusable Intelligence

Agents and skills MUST be designed for reuse across phases and features.

**Persistent Subagents**:
- **spec_writer**: Owns all specification documents, ensures completeness
- **planner_agent**: Converts specs into implementation plans
- **task_designer**: Breaks plans into atomic, executable tasks
- **backend_implementer**: Implements FastAPI logic (REST APIs, JWT verification, user isolation, SQLModel)
- **frontend_implementer**: Implements Next.js logic (UI components, Better Auth, API integration)
- **quality_reviewer**: Validates correctness, compliance, auth enforcement, phase boundaries

**Agent Skills**:

*Core Skills*:
- spec_driven_development
- phase_based_feature_enforcement
- traceability_management

*Backend Skills*:
- fastapi_api_design
- jwt_authentication_validation
- sqlmodel_orm_usage
- neon_postgres_integration
- user_data_isolation

*Frontend Skills*:
- nextjs_app_router_patterns
- better_auth_integration
- secure_api_client_design
- responsive_ui_composition

*Full-Stack Skills*:
- api_contract_enforcement
- frontend_backend_coordination
- monorepo_navigation
- env_secret_management

**Agent Invocation Order**:
1. spec_writer
2. planner_agent
3. task_designer
4. backend_implementer / frontend_implementer (parallel)
5. quality_reviewer

**Rules**:
- MUST reuse existing agents instead of creating new ones
- MUST document agent capabilities and interfaces
- MUST maintain agent versioning and compatibility
- MUST NOT duplicate agent functionality
- Agents are logical roles, not separate tools

**Rationale**: Reusable agents improve with experience, reduce development time, and ensure consistent quality. Agent intelligence compounds across iterations.

---

### X. Documentation Standards

All documentation MUST be clear, accurate, and maintained throughout the project lifecycle.

**Required Documentation**:
- **README.md**: Project overview, setup instructions for frontend/backend, how to run, auth flow explanation
- **CLAUDE.md** (Root): Spec Agent System & Skills Definition, applies to all phases
- **CLAUDE.md** (Frontend): Frontend-specific rules and constraints
- **CLAUDE.md** (Backend): Backend-specific rules and constraints
- **constitution.md**: This file - project principles and governance
- **specs/**: Phase-specific specifications and plans

**Rules**:
- MUST update documentation with code changes
- MUST include setup instructions for each phase
- MUST provide usage examples for all features
- MUST document phase-specific constraints
- MUST explain authentication flow and security model

**Rationale**: Good documentation enables onboarding, prevents misuse, and serves as a contract between developers and users.

---

## One-Time Constitution Rule

This constitution is:
- Written once
- Applies to all phases
- Never rewritten (only referenced and amended)
- All future work must conform to this document

---

## Phase Model

The project progresses through three cumulative phases. Each phase builds on previous phases and must be completed before advancing.

| Phase | Name | Scope | Features |
|-------|------|-------|----------|
| **CLI** | Predecessor | Console app | Not an active phase - CLI work is complete |
| **Phase 1** | Core Web App | Basic CRUD + Auth | Add, View, Update, Delete, Complete/Incomplete + User Authentication |
| **Phase 2** | Usability | Search, filter, sort | Enhanced task discovery and organization |
| **Phase 3** | Intelligence | Advanced automation | Smart features and automation |

**Phase 1 - Full-Stack Basic Level (Mandatory)**:

Must implement all 5 Basic Level features as a web application:
1. Add Task
2. View Task List
3. Update Task
4. Delete Task
5. Mark Task Complete / Incomplete

Each task MUST be:
- Associated with a logged-in user
- Persisted in the database
- Isolated from other users' data

**Phase Transition Criteria**:
- All mandatory features implemented and tested
- All acceptance criteria met
- Authentication and security verified
- System demonstrated and validated
- Documentation updated
- User approval obtained

---

## Technology Stack

**Frontend**:
- Next.js 16+ (App Router)
- TypeScript
- Better Auth (authentication)
- Responsive UI

**Backend**:
- Python FastAPI
- SQLModel ORM
- JWT authentication
- Pydantic validation

**Database**:
- Neon Serverless PostgreSQL

**Development Tools**:
- Claude Code (AI coding assistant)
- Spec-Kit Plus (specification framework)
- Docker Compose (orchestration)

**Environment Management**:
- Frontend: npm/pnpm
- Backend: UV (Python package manager)

**Constraints**:
- MUST use specified stack
- NO deviations from technology choices without constitution amendment
- NO external AI APIs unless specified in phase requirements

---

## Spec-Kit Plus Integration

**Spec Reference Notation**: `@specs/features/feature-name.md`

**Required Reading Order**:
1. Root CLAUDE.md
2. Relevant spec files (`@specs/...`)
3. Layer-specific CLAUDE.md (frontend or backend)

**Spec Conventions**:
- Specs MUST follow Spec-Kit conventions
- All specs stored in `specs/` directory
- Feature specs in `specs/features/`
- API contracts in `specs/api/`
- Database schemas in `specs/database/`
- UI specs in `specs/ui/`

---

## Evaluation & Review Criteria

Projects will be evaluated on:

1. **Phase Isolation**: Clear boundaries, no premature features
2. **Spec Quality**: Complete, testable, traceable requirements
3. **Architecture**: Clean, modular, full-stack design
4. **Security**: JWT enforcement, user isolation, no auth bypass
5. **API Contracts**: Stable, versioned, strictly followed
6. **Code Quality**: Readable, type-safe, well-tested code
7. **Documentation**: Complete, accurate, up-to-date
8. **Process Adherence**: Workflow followed, PHRs created, ADRs documented
9. **Functionality**: All features work as specified
10. **Intelligence Reuse**: Agents reused effectively across phases

---

## Governance

### Amendment Process

This constitution may be amended when:
- New phases or requirements are added
- Principles conflict with practical needs
- Technology stack changes significantly
- User feedback indicates principle gaps

**Amendment Procedure**:
1. Propose amendment with rationale
2. Document impact on existing work
3. Update constitution version (semantic versioning)
4. Propagate changes to dependent templates
5. Obtain user approval
6. Create ADR documenting the change
7. Update CLAUDE.md if workflow changes

### Versioning Policy

Constitution versions follow semantic versioning (MAJOR.MINOR.PATCH):
- **MAJOR**: Backward-incompatible principle changes, architecture shifts, or removals
- **MINOR**: New principles, sections, or material expansions
- **PATCH**: Clarifications, wording improvements, typo fixes

### Compliance Review

All development work MUST:
- Reference this constitution for guidance
- Validate compliance before phase completion
- Document justification for any exceptions
- Report violations to user for resolution

**Enforcement**:
- Constitution supersedes all other practices
- Plan template includes constitution check gate
- Tasks must align with constitution principles
- Code review verifies compliance (auth, phase boundaries, scope creep)

---

## Architectural Decision Records (ADR)

**Three-Part Significance Test**:
- **Impact**: Long-term consequences? (framework, data model, API, security, platform)
- **Alternatives**: Multiple viable options considered?
- **Scope**: Cross-cutting and influences system design?

**If ALL true**, suggest:
```
ðŸ“‹ Architectural decision detected: [brief-description]
   Document reasoning and tradeoffs? Run `/sp.adr [decision-title]`
```

**Rules**:
- Wait for user consent; never auto-create ADRs
- Group related decisions (stacks, authentication, deployment) into one ADR when appropriate
- ADRs typically identified during planning and task design
- Store in `history/adr/`

---

## Prompt History Records (PHR)

**Mandatory Creation**: After every user input (except `/sp.phr` itself)

**Routing** (all under `history/prompts/`):
- Constitution â†’ `history/prompts/constitution/`
- Feature-specific â†’ `history/prompts/<feature-name>/`
- General â†’ `history/prompts/general/`

**Creation Process**: See root CLAUDE.md for detailed PHR creation workflow

---

**Version**: 2.0.0 | **Ratified**: 2025-12-24 | **Last Amended**: 2025-12-24
