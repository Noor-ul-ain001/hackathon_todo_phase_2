---
id: 2
title: Full-Stack Web Application Constitution Amendment
stage: constitution
date: 2025-12-24
surface: agent
model: claude-sonnet-4-5
feature: none
branch: master
user: Noor-ul-ain001
command: /sp.constitution
labels: ["constitution", "full-stack", "web-app", "authentication", "monorepo", "architecture"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
 - .specify/memory/constitution.md
tests:
 - none
---

## Prompt

```text
Spec-Kit Plus Master Constitution
Todo Full-Stack Web Application (Hackathon Part 2)
1. Project Identity

Project Name
Agentic Todo â€“ Full-Stack Web Application

Objective
Transform the existing Todo console application into a modern, multi-user, full-stack web application using spec-driven, agentic development powered by Claude Code + Spec-Kit Plus.

The system must support persistent storage, authentication, REST APIs, and a responsive frontend, while strictly following the Agentic Dev Stack workflow.

2. One-Time Constitution Rule

This constitution is:

Written once

Applies to all phases

Never rewritten (only referenced)

All future work must conform to this document.

3. Development Philosophy (Non-Negotiable)

Spec-First Development
No code without an approved spec.

Agentic Workflow Only
Write spec â†’ plan â†’ tasks â†’ implement â†’ review.

No Manual Coding
All frontend and backend code must be generated by Claude Code.

Phase-Bound Enforcement
Only features allowed by the current phase spec may be implemented.

Traceability
Every line of code must trace back to a spec.

4. Phase Model
Phase    Name    Scope
Phase 1    Core Web App    Basic CRUD + Auth
Phase 2    Usability    Search, filter, sort
Phase 3    Intelligence    Advanced automation

âš ï¸ CLI is considered a predecessor, not an active phase.

5. Phase 1 â€“ Full-Stack Basic Level (Mandatory)
Functional Requirements

Implement all 5 Basic Level features as a web application:

Add Task

View Task List

Update Task

Delete Task

Mark Task Complete / Incomplete

Each task must be:

Associated with a logged-in user

Persisted in the database

6. Architecture (Full-Stack)
Frontend

Next.js 16+ (App Router)

TypeScript

Responsive UI

Communicates via REST API

Backend

Python FastAPI

RESTful API design

Stateless authentication via JWT

Database

Neon Serverless PostgreSQL

SQLModel ORM

7. Authentication & Security (Critical)
Authentication System

Better Auth on frontend

JWT tokens issued on login

Security Rules

All API endpoints require a valid JWT

JWT passed via:

Authorization: Bearer <token>


Backend verifies token signature

User identity is extracted from token

All queries are filtered by authenticated user

Shared Secret

JWT signing secret must be shared via:

BETTER_AUTH_SECRET

8. API Contract (Stable)

Base path:

/api/{user_id}/tasks

Method    Endpoint    Description
GET    /api/{user_id}/tasks    List user tasks
POST    /api/{user_id}/tasks    Create task
GET    /api/{user_id}/tasks/{id}    Get task
PUT    /api/{user_id}/tasks/{id}    Update task
DELETE    /api/{user_id}/tasks/{id}    Delete task
PATCH    /api/{user_id}/tasks/{id}/complete    Toggle completion

Backend must verify that user_id matches the JWT identity.

9. Data Model (Phase-Safe)
Task Entity
Task
- id: int
- user_id: string
- title: string
- description: string | null
- completed: boolean
- created_at: datetime
- updated_at: datetime


No additional fields allowed unless introduced by a later spec.

10. Monorepo Requirement

The project must use a monorepo.

hackathon-todo/
â”œâ”€â”€ .spec-kit/
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ specs/
â”‚   â”œâ”€â”€ overview.md
â”‚   â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ database/
â”‚   â””â”€â”€ ui/
â”œâ”€â”€ CLAUDE.md
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ CLAUDE.md
â”‚   â””â”€â”€ (Next.js app)
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ CLAUDE.md
â”‚   â””â”€â”€ (FastAPI app)
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md

11. Spec-Kit Plus Rules

Specs must follow Spec-Kit conventions

Specs are referenced using:

@specs/features/feature-name.md


Claude Code must read:

Root CLAUDE.md

Relevant spec files

Layer-specific CLAUDE.md

12. Reusable Intelligence (Required)
Subagents (Persistent)

spec_writer

planner_agent

task_designer

frontend_implementer

backend_implementer

quality_reviewer

Agent Skills

spec_driven_development

full_stack_architecture

jwt_authentication

database_modeling

api_contract_enforcement

13. Documentation Requirements
README.md

Project overview

Setup instructions

How to run frontend & backend

Auth flow explanation

CLAUDE.md (Root)

Spec Agent System & Skills Definition
(Mandatory for All Phases)

This project must use reusable agent intelligence. Agents and skills are defined once and reused across CLI â†’ Full-Stack â†’ Advanced phases.

16. Agent Roles (Persistent Subagents)

Claude Code must explicitly operate through the following agents.
Agents are logical roles, not separate tools.

ğŸŸ¦ 1. spec_writer Agent

Purpose

Owns all specification documents

Ensures specs are complete, unambiguous, and phase-safe

Responsibilities

Write new specs

Update existing specs when requirements change

Enforce constitution rules inside specs

Allowed Actions

Modify files under /specs/**

Clarify acceptance criteria

ğŸŸ¦ 2. planner_agent

Purpose

Convert specs into implementation plans

Responsibilities

Read referenced specs

Define architecture-level steps

Identify frontend vs backend work

Allowed Actions

Produce implementation plans

Reference specs using @specs/...

ğŸŸ¦ 3. task_designer

Purpose

Break plans into atomic, executable tasks

Responsibilities

Create granular tasks

Maintain traceability to specs

Ensure tasks are small and testable

Allowed Actions

Define task lists

Map tasks â†’ specs

ğŸŸ¦ 4. backend_implementer

Purpose

Implement backend logic in FastAPI

Responsibilities

Build REST APIs

Implement JWT verification

Enforce user isolation

Use SQLModel correctly

Allowed Actions

Modify /backend/**

Implement database queries

Add middleware and routes

Restrictions

Must not change specs

Must not bypass auth

ğŸŸ¦ 5. frontend_implementer

Purpose

Implement frontend logic in Next.js

Responsibilities

Build UI components

Integrate Better Auth

Attach JWT tokens to API requests

Consume REST APIs

Allowed Actions

Modify /frontend/**

Use API client abstraction

Build responsive UI

Restrictions

No direct DB access

No backend logic duplication

ğŸŸ¦ 6. quality_reviewer

Purpose

Validate correctness and compliance

Responsibilities

Verify code matches specs

Check auth enforcement

Detect scope creep

Validate phase boundaries

Allowed Actions

Review code

Produce review reports

Flag violations

17. Agent Skills (Reusable Capabilities)

These skills must be reused, not redefined, across phases.

ğŸ§© Core Skills

spec_driven_development

phase_based_feature_enforcement

traceability_management

ğŸ§© Backend Skills

fastapi_api_design

jwt_authentication_validation

sqlmodel_orm_usage

neon_postgres_integration

user_data_isolation

ğŸ§© Frontend Skills

nextjs_app_router_patterns

better_auth_integration

secure_api_client_design

responsive_ui_composition

ğŸ§© Full-Stack Skills

api_contract_enforcement

frontend_backend_coordination

monorepo_navigation

env_secret_management

18. Agent Invocation Rule (Important)

Claude Code must implicitly or explicitly operate in this order:

spec_writer

planner_agent

task_designer

backend_implementer / frontend_implementer

quality_reviewer
```

## Response snapshot

Successfully updated the Agentic Todo constitution from v1.0.0 (CLI-based) to v2.0.0 (Full-Stack Web Application).

**Major Changes**:
- **Architecture Transformation**: CLI â†’ Full-Stack (Next.js + FastAPI + PostgreSQL)
- **Security Model**: Added comprehensive JWT authentication with Better Auth
- **Monorepo Structure**: Introduced frontend/backend separation with layer-specific CLAUDE.md files
- **Agent Expansion**: Added frontend_implementer and backend_implementer agents with specialized skills
- **API Contract**: Defined RESTful API specification with 6 endpoints
- **Data Model**: Enhanced Task entity with user_id, created_at, updated_at for multi-user support
- **Phase Redefinition**: CLI becomes predecessor; Phase 1 = Core Web App with Auth

**New Principles**:
- Principle V: Authentication & Security (CRITICAL) - JWT validation on all endpoints
- Principle VI: API Contract Stability - Stable, versioned contracts
- Principle VII: Data Model Integrity - User isolation and referential integrity
- Principle VIII: Monorepo Structure - Coordinated but separated layers

**Agent Skills Added**:
- Backend: fastapi_api_design, jwt_authentication_validation, sqlmodel_orm_usage, neon_postgres_integration, user_data_isolation
- Frontend: nextjs_app_router_patterns, better_auth_integration, secure_api_client_design, responsive_ui_composition
- Full-Stack: api_contract_enforcement, frontend_backend_coordination, monorepo_navigation, env_secret_management

Constitution file updated at: `.specify/memory/constitution.md`

## Outcome

- âœ… Impact: Major architectural transformation documented; full-stack web development principles established
- ğŸ§ª Tests: No tests (documentation update)
- ğŸ“ Files: .specify/memory/constitution.md (updated)
- ğŸ” Next prompts: Update README.md to reflect full-stack architecture; validate template compatibility; begin Phase 1 spec creation
- ğŸ§  Reflection: This amendment represents a significant evolution from CLI to enterprise-grade full-stack application with authentication, security, and multi-user support. All principles maintain backward compatibility with spec-driven workflow while adding necessary constraints for web development.

## Evaluation notes (flywheel)

- Failure modes observed: None
- Graders run and results (PASS/FAIL): PASS - Constitution properly versioned, all placeholders filled, comprehensive coverage
- Prompt variant (if applicable): Standard constitution amendment workflow
- Next experiment (smallest change to try): Validate that existing templates (plan, spec, tasks) support monorepo structure and full-stack categorization
